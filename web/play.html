<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>WebWars ‚Äî Play</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0e1a;color:#e0e0e0;font-family:'Segoe UI',system-ui,-apple-system,sans-serif;min-height:100vh;display:flex;flex-direction:column;align-items:center}
.logo{font-weight:900;font-size:42px;letter-spacing:4px;margin-top:48px;background:linear-gradient(135deg,#ff6b6b,#ffd93d,#6bcb77,#4d96ff,#9b59b6);background-size:200% auto;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:shine 3s linear infinite}
@keyframes shine{to{background-position:200% center}}
.subtitle{color:#5a6480;font-size:14px;margin-top:6px;margin-bottom:32px}
.cards{display:flex;gap:20px;flex-wrap:wrap;justify-content:center;max-width:800px;padding:0 20px}
.card{background:#111627;border:1px solid #1e2744;border-radius:12px;padding:28px 24px;width:240px;cursor:pointer;transition:all .2s;text-decoration:none;color:inherit;display:flex;flex-direction:column;align-items:center;text-align:center}
.card:hover{border-color:#4fc3f7;transform:translateY(-4px);box-shadow:0 8px 32px rgba(79,195,247,0.15)}
.card .icon{font-size:40px;margin-bottom:14px}
.card h3{font-size:16px;font-weight:700;margin-bottom:6px}
.card p{font-size:12px;color:#5a6480;line-height:1.5}

/* Custom game panel */
#custom-panel{display:none;background:#111627;border:1px solid #1e2744;border-radius:12px;padding:28px 32px;margin-top:24px;max-width:560px;width:calc(100% - 40px)}
#custom-panel h3{font-size:16px;font-weight:700;margin-bottom:16px}
.cfg-row{display:flex;align-items:flex-start;margin-bottom:14px}
.cfg-row label{width:90px;font-size:13px;color:#8892b0;padding-top:7px;flex-shrink:0}
.cfg-right{flex:1;display:flex;flex-direction:column}
.cfg-right select{background:#0a0e1a;color:#e0e0e0;border:1px solid #2a3352;border-radius:6px;padding:6px 10px;font-size:13px;width:100%}
.cfg-right select:focus{outline:none;border-color:#4fc3f7}
.cfg-desc{font-size:11px;color:#5a6480;margin-top:4px;line-height:1.4;min-height:15px}
.cfg-lock{font-size:11px;color:#ffd93d;margin-top:4px}
.btn-row{display:flex;gap:10px;margin-top:18px}
.btn{padding:8px 20px;border-radius:6px;border:none;cursor:pointer;font-size:13px;font-weight:600;transition:all .15s}
.btn-primary{background:linear-gradient(135deg,#4fc3f7,#66bb6a);color:#0a0e1a}
.btn-primary:hover{opacity:.9;transform:translateY(-1px)}
.btn-secondary{background:none;border:1px solid #2a3352;color:#8892b0}
.btn-secondary:hover{border-color:#4fc3f7;color:#4fc3f7}
select:disabled{opacity:.5;cursor:not-allowed}
.tab-btn.active-tab{border-color:#4fc3f7;color:#4fc3f7}
.team-col{flex:1;min-width:200px}
.team-col h4{font-size:13px;font-weight:600;margin-bottom:8px}
.team-col input{background:#0a0e1a;color:#e0e0e0;border:1px solid #2a3352;border-radius:4px;padding:4px 8px;font-size:12px;width:100%;margin-bottom:4px}
.team-col input:focus{outline:none;border-color:#4fc3f7}

.footer{margin-top:auto;padding:24px;font-size:11px;color:#3d4560;text-align:center}
.footer a{color:#4a5270;text-decoration:none}
.footer a:hover{color:#4fc3f7}
</style>
</head>
<body>

<div class="logo">WEBWARS</div>
<div class="subtitle">Hedgewars in your browser ‚Äî no download required</div>

<div class="cards">
  <a class="card" href="index.html">
    <div class="icon">‚ö°</div>
    <h3>Quick Play</h3>
    <p>Jump straight in. Random map, two teams, hotseat.</p>
  </a>
  <div class="card" id="custom-card" onclick="showCustom()">
    <div class="icon">üéÆ</div>
    <h3>Custom Game</h3>
    <p>Pick your scheme, weapons, and game style before playing.</p>
  </div>
  <a class="card" href="lobby.html">
    <div class="icon">üåê</div>
    <h3>Multiplayer</h3>
    <p>Play online against others. Create or join a room.</p>
  </a>
  <div class="card" id="missions-card" onclick="showMissions()">
    <div class="icon">üèÜ</div>
    <h3>Single Player</h3>
    <p>Training, challenges, scenarios, and campaigns.</p>
  </div>
</div>

<div id="missions-panel" style="display:none;background:#111627;border:1px solid #1e2744;border-radius:12px;padding:28px 32px;margin-top:24px;max-width:560px;width:calc(100% - 40px)">
  <h3 id="missions-title">Single Player</h3>
  <div style="display:flex;gap:8px;margin:12px 0 16px">
    <button class="btn btn-secondary tab-btn active-tab" onclick="showTab('training')">Training</button>
    <button class="btn btn-secondary tab-btn" onclick="showTab('challenge')">Challenges</button>
    <button class="btn btn-secondary tab-btn" onclick="showTab('scenario')">Scenarios</button>
    <button class="btn btn-secondary tab-btn" onclick="showTab('campaign')">Campaigns</button>
  </div>
  <div id="mission-list" style="max-height:300px;overflow-y:auto"></div>
  <div class="btn-row">
    <button class="btn btn-secondary" onclick="hideMissions()">Back</button>
  </div>
</div>

<div id="custom-panel">
  <h3>Custom Game Setup</h3>

  <div class="cfg-row">
    <label>Map</label>
    <div class="cfg-right">
      <select id="cfg-map" onchange="onMapChange()">
        <option value="random">Random</option>
        <option value="maze">Maze</option>
        <option value="perlin">Perlin</option>
        <option value="forts">Forts</option>
      </select>
      <div class="cfg-desc" id="desc-map">Randomly generated terrain.</div>
    </div>
  </div>
  <div class="cfg-row">
    <label>Theme</label>
    <div class="cfg-right">
      <select id="cfg-theme" onchange="onThemeChange()"></select>
      <div class="cfg-desc" id="desc-theme"></div>
    </div>
  </div>
  <div class="cfg-row">
    <label>Style</label>
    <div class="cfg-right">
      <select id="cfg-style" onchange="onStyleChange()"></select>
      <div class="cfg-desc" id="desc-style"></div>
      <div class="cfg-lock" id="lock-msg"></div>
    </div>
  </div>
  <div class="cfg-row">
    <label>Scheme</label>
    <div class="cfg-right">
      <select id="cfg-scheme" onchange="onSchemeChange()"></select>
      <div class="cfg-desc" id="desc-scheme"></div>
    </div>
  </div>
  <div class="cfg-row">
    <label>Weapons</label>
    <div class="cfg-right">
      <select id="cfg-weapons" onchange="onWeaponsChange()"></select>
      <div class="cfg-desc" id="desc-weapons"></div>
    </div>
  </div>

  <div class="btn-row">
    <button class="btn btn-primary" onclick="launchCustom()">‚ñ∂ Start Game</button>
    <button class="btn btn-secondary" onclick="hideCustom()">Cancel</button>
    <button class="btn btn-secondary" onclick="toggleTeamEditor()" id="btn-teams">‚úèÔ∏è Teams</button>
  </div>
  <div id="team-editor" style="display:none;margin-top:16px;border-top:1px solid #1e2744;padding-top:16px">
    <div style="display:flex;gap:20px;flex-wrap:wrap">
      <div class="team-col" id="team-0-col"></div>
      <div class="team-col" id="team-1-col"></div>
    </div>
  </div>
</div>

<div class="footer">
  Built on <a href="https://hedgewars.org" target="_blank">Hedgewars</a> (GPL v2) ¬∑
  <a href="https://github.com/apmlabs/webwars" target="_blank">GitHub</a>
</div>

<script src="gameconfig.js"></script>
<script>
(function(){
  var selTheme=document.getElementById('cfg-theme');
  var selStyle=document.getElementById('cfg-style');
  var selScheme=document.getElementById('cfg-scheme');
  var selWeapons=document.getElementById('cfg-weapons');

  GameConfig.THEMES.forEach(function(t){
    var o=document.createElement('option'); o.value=t.name; o.textContent=t.name; selTheme.appendChild(o);
  });
  GameConfig.STYLES.forEach(function(s){
    var o=document.createElement('option'); o.value=s.name; o.textContent=s.name; selStyle.appendChild(o);
  });
  GameConfig.SCHEMES.forEach(function(s){
    var o=document.createElement('option'); o.value=s.name; o.textContent=s.name; selScheme.appendChild(o);
  });
  GameConfig.WEAPONS.forEach(function(w){
    var o=document.createElement('option'); o.value=w.name; o.textContent=w.name; selWeapons.appendChild(o);
  });

  // Show initial descriptions
  onThemeChange();
  onStyleChange();
  onSchemeChange();
  onWeaponsChange();
})();

function onMapChange(){
  var descs={random:'Randomly generated terrain.',maze:'Maze-like tunnels and corridors.',perlin:'Smooth, organic terrain using Perlin noise.',forts:'Two forts facing each other across a gap.'};
  document.getElementById('desc-map').textContent=descs[document.getElementById('cfg-map').value]||'';
}function onThemeChange(){
  var t=GameConfig.findTheme(document.getElementById('cfg-theme').value);
  document.getElementById('desc-theme').textContent=t.desc||'';
}

function findStyle(name){
  for(var i=0;i<GameConfig.STYLES.length;i++) if(GameConfig.STYLES[i].name===name) return GameConfig.STYLES[i];
  return GameConfig.STYLES[0];
}

function onStyleChange(){
  var style=findStyle(document.getElementById('cfg-style').value);
  document.getElementById('desc-style').textContent=style.desc||'';

  var selScheme=document.getElementById('cfg-scheme');
  var selWeapons=document.getElementById('cfg-weapons');
  var lockMsg=document.getElementById('lock-msg');
  var msgs=[];

  // Apply locks from game style .cfg (like Qt client)
  if(style.lock){
    if(style.lock.scheme && style.lock.scheme!==true){
      selScheme.value=style.lock.scheme;
      selScheme.disabled=true;
      msgs.push('Scheme locked to '+style.lock.scheme);
    } else { selScheme.disabled=false; }

    if(style.lock.weapons===true){
      selWeapons.disabled=true;
      msgs.push('Weapons controlled by script');
    } else if(style.lock.weapons){
      selWeapons.value=style.lock.weapons;
      selWeapons.disabled=true;
      msgs.push('Weapons locked to '+style.lock.weapons);
    } else { selWeapons.disabled=false; }
  } else {
    selScheme.disabled=false;
    selWeapons.disabled=false;
  }

  lockMsg.textContent=msgs.length?'üîí '+msgs.join('. '):'';
  onSchemeChange();
  onWeaponsChange();
}

function onSchemeChange(){
  var s=GameConfig.findScheme(document.getElementById('cfg-scheme').value);
  document.getElementById('desc-scheme').textContent=s.desc||'';
}

function onWeaponsChange(){
  var w=GameConfig.findWeapon(document.getElementById('cfg-weapons').value);
  document.getElementById('desc-weapons').textContent=w.desc||'';
}

function showCustom(){
  document.getElementById('custom-panel').style.display='block';
  document.getElementById('missions-panel').style.display='none';
  document.getElementById('custom-card').style.borderColor='#4fc3f7';
  document.getElementById('missions-card').style.borderColor='';
}
function hideCustom(){
  document.getElementById('custom-panel').style.display='none';
  document.getElementById('custom-card').style.borderColor='';
}
function launchCustom(){
  var m=document.getElementById('cfg-map').value;
  var t=document.getElementById('cfg-theme').value;
  var s=document.getElementById('cfg-scheme').value;
  var w=document.getElementById('cfg-weapons').value;
  var g=document.getElementById('cfg-style').value;
  var url='index.html?theme='+encodeURIComponent(t)+'&scheme='+encodeURIComponent(s)+'&weapons='+encodeURIComponent(w)+'&style='+encodeURIComponent(g);
  if(m!=='random') url+='&map='+encodeURIComponent(m);
  window.location.href=url;
}

// ‚îÄ‚îÄ Missions panel ‚îÄ‚îÄ
var _currentTab='training';
var _currentCampaign=null;

function showMissions(){
  document.getElementById('missions-panel').style.display='block';
  document.getElementById('custom-panel').style.display='none';
  document.getElementById('missions-card').style.borderColor='#4fc3f7';
  document.getElementById('custom-card').style.borderColor='';
  showTab('training');
}
function hideMissions(){
  if(_currentCampaign){_currentCampaign=null;showTab('campaign');return;}
  document.getElementById('missions-panel').style.display='none';
  document.getElementById('missions-card').style.borderColor='';
}
function showTab(tab){
  _currentTab=tab;_currentCampaign=null;
  document.querySelectorAll('.tab-btn').forEach(function(b){b.classList.remove('active-tab');if(b.textContent.toLowerCase().indexOf(tab)===0)b.classList.add('active-tab');});
  var list=document.getElementById('mission-list');
  list.innerHTML='';
  if(tab==='campaign'){
    GameConfig.MISSIONS.campaign.forEach(function(c){
      var d=document.createElement('div');
      d.style.cssText='padding:10px 12px;border:1px solid #1e2744;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:border-color .15s';
      d.onmouseenter=function(){d.style.borderColor='#4fc3f7'};
      d.onmouseleave=function(){d.style.borderColor='#1e2744'};
      d.innerHTML='<div style="font-size:14px;font-weight:600">'+c.title+'</div><div style="font-size:11px;color:#5a6480;margin-top:2px">'+c.missions.length+' missions</div>';
      d.onclick=function(){showCampaignMissions(c)};
      list.appendChild(d);
    });
  } else {
    var missions=GameConfig.MISSIONS[tab]||[];
    missions.forEach(function(m){
      var d=document.createElement('div');
      d.style.cssText='padding:10px 12px;border:1px solid #1e2744;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:border-color .15s';
      d.onmouseenter=function(){d.style.borderColor='#4fc3f7'};
      d.onmouseleave=function(){d.style.borderColor='#1e2744'};
      d.textContent=m.title;d.style.fontSize='13px';
      var folder=tab==='training'?'Training':tab==='challenge'?'Challenge':'Scenario';
      d.onclick=function(){window.location.href='index.html?mission='+encodeURIComponent('Missions/'+folder+'/'+m.name+'.lua')};
      list.appendChild(d);
    });
  }
}
function showCampaignMissions(c){
  _currentCampaign=c;
  document.getElementById('missions-title').textContent=c.title;
  var list=document.getElementById('mission-list');
  list.innerHTML='';
  c.missions.forEach(function(m){
    var d=document.createElement('div');
    d.style.cssText='padding:10px 12px;border:1px solid #1e2744;border-radius:8px;margin-bottom:8px;cursor:pointer;transition:border-color .15s;font-size:13px';
    d.onmouseenter=function(){d.style.borderColor='#4fc3f7'};
    d.onmouseleave=function(){d.style.borderColor='#1e2744'};
    d.textContent=m.title;
    d.onclick=function(){window.location.href='index.html?mission='+encodeURIComponent('Missions/Campaign/'+c.name+'/'+m.script)};
    list.appendChild(d);
  });
}

// ‚îÄ‚îÄ Team editor ‚îÄ‚îÄ
var HATS=['NoHat','Santa','Viking','Cowboy','crown','Samurai','WizardHat','pirate_hat','knight','Rambo','Einstein','chef','constructor','angel','Evil','Skull','Zombi','clown','jester','Sniper','Glasses','Sunglasses','cap_blue','cap_red','sm_mario','sm_luigi','sth_Sonic'];
var _defaultTeams=[
  {name:'Red Team',hogs:['Hog A1','Hog A2','Hog A3','Hog A4'],hat:'NoHat'},
  {name:'Blue Team',hogs:['Hog B1','Hog B2','Hog B3','Hog B4'],hat:'NoHat'}
];
function loadTeams(){try{var t=JSON.parse(localStorage.getItem('hw_teams'));if(t&&t[0]&&t[1])return t}catch(e){}return JSON.parse(JSON.stringify(_defaultTeams))}
function saveTeams(teams){localStorage.setItem('hw_teams',JSON.stringify(teams))}
function toggleTeamEditor(){
  var el=document.getElementById('team-editor');
  if(el.style.display==='none'){el.style.display='block';buildTeamEditor()}
  else el.style.display='none';
}
function buildTeamEditor(){
  var teams=loadTeams();
  var colors=['#ff4c4c','#4c9aff'];
  for(var t=0;t<2;t++){
    var col=document.getElementById('team-'+t+'-col');
    col.innerHTML='<h4 style="color:'+colors[t]+'">Team '+(t+1)+'</h4>';
    var ni=document.createElement('input');ni.placeholder='Team name';ni.value=teams[t].name;ni.dataset.team=t;ni.dataset.field='name';ni.oninput=onTeamInput;
    col.appendChild(ni);
    var sel=document.createElement('select');sel.style.cssText='background:#0a0e1a;color:#e0e0e0;border:1px solid #2a3352;border-radius:4px;padding:4px 8px;font-size:12px;width:100%;margin-bottom:8px';
    sel.dataset.team=t;sel.onchange=function(){var tm=loadTeams();tm[this.dataset.team].hat=this.value;saveTeams(tm)};
    HATS.forEach(function(h){var o=document.createElement('option');o.value=h;o.textContent=h;if(h===teams[t].hat)o.selected=true;sel.appendChild(o)});
    col.appendChild(sel);
    for(var i=0;i<4;i++){
      var hi=document.createElement('input');hi.placeholder='Hedgehog '+(i+1);hi.value=teams[t].hogs[i]||'';hi.dataset.team=t;hi.dataset.hog=i;hi.oninput=onTeamInput;
      col.appendChild(hi);
    }
  }
}
function onTeamInput(){
  var teams=loadTeams();var t=this.dataset.team;
  if(this.dataset.field==='name')teams[t].name=this.value;
  else if(this.dataset.hog!==undefined)teams[t].hogs[this.dataset.hog]=this.value;
  saveTeams(teams);
}
</script>
