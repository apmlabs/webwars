# Generated C Source (pas2c output)

These files are the C output of [pas2c](https://github.com/hedgewars/hw/tree/master/tools/pas2c), which converts the Hedgewars Pascal engine into C. They are checked in for reference — the build system regenerates them automatically.

## What's here

- `pas2c/*.c` — 62 C source files (~70K lines) converted from the Pascal engine
- `pas2c/*.h` — 64 corresponding headers

## What's NOT here (generated by the build)

The full build directory is ~89MB. We only check in the pas2c output (3.2MB). The rest is regenerated automatically when you build:

- **Object files** (`*.o`, ~86MB) — compiled by `emcc` during `make`
- **`config.inc`** — build-time constants (version string, data paths) generated by CMake from `config.inc.in`
- **`rtl/`** (fpcrtl runtime library) — already in the repo at [`hedgewars/project_files/hwc/rtl/`](../hedgewars/project_files/hwc/rtl/). This is the C runtime that pas2c-generated code depends on (string handling, file I/O, math, type system)
- **`ipc_browser.c`** and **`web_entry.c`** — our custom C shims, already in the repo at [`hedgewars/project_files/hwc/`](../hedgewars/project_files/hwc/)

To regenerate everything, run the build (see below).

## How they're generated

During `cmake` configure, the `pas2c` tool (a Haskell binary in `hedgewars/tools/pas2c/`) converts every `.pas` file in `hedgewars/hedgewars/` into C. The output lands in `build/wasm/project_files/hwc/`. These are then compiled by Emscripten (`emcc`) into WebAssembly.

## Build dependencies

To compile the generated C to WASM, you need:

- [Emscripten SDK](https://emscripten.org/docs/getting_started/downloads.html) (provides `emcc`, SDL2, SDL_net via ports)
- Rust with `wasm32-unknown-emscripten` target (for the map generator)
- CMake 3.20+

The C code depends on:
- **SDL2** — windowing, input, audio (via Emscripten ports: `-sUSE_SDL=2`)
- **SDL_net** — stubbed out for browser builds (replaced by `ipc_browser.c`)
- **PhysFS** — virtual filesystem (bundled in `hedgewars/misc/libphysfs/`)
- **Lua 5.1** — game scripting (bundled in `hedgewars/misc/liblua/`)
- **FreeType** — font rendering (via Emscripten ports)
- **libpng, zlib, libogg, libvorbis** — assets (via Emscripten ports)

## Building from source

```bash
source ~/emsdk/emsdk_env.sh
source ~/.cargo/env
mkdir -p build/wasm && cd build/wasm && rm -rf *
cmake ../../hedgewars -DBUILD_ENGINE_JS=ON -DNOSERVER=ON \
  -DCMAKE_TOOLCHAIN_FILE=$EMSDK/upstream/emscripten/cmake/Modules/Platform/Emscripten.cmake
make -j$(nproc)
```

This regenerates the pas2c C files, compiles them with `emcc`, and produces `hwengine.wasm` + `hwengine.js` + `hwengine.data` in `build/wasm/bin/`.

See the main [README](../README.md) for full instructions including the game server and gateway.
